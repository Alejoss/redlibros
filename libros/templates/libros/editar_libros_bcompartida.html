{% extends 'base.html' %}

{% block content %}

<h1>{{biblioteca_compartida.nombre}} <small>administrar libros</small></h1>

<h3>Libros de {{biblioteca_compartida.nombre}}</h3>

{% for l in libros_disponibles %}
	<div class = "panel panel-primary">
		<div class = "panel-body">
			<p> {{l.libro.titulo}} | {{l.libro.autor}} </p>		
			<a class = "marcar_no_disponible" href="" data-id="{{l.id}}">Marcar como No Disponible</a>
			<a href="{% url 'libros:prestar_libro_bcompartida' l.id %}">Prestar Libro</a>	
		</div>
	</div>
{% endfor %}

<h3>No Disponibles</h3>
{% for l in libros_no_disponibles %}
	<div class = "panel panel-primary">
		<div class = "panel-body">
			<p> {{l.libro.titulo}} | {{l.libro.autor}} </p>
			
			{% if l.prestado %}
				<p> Este libro fue prestado </p>
			{% else %}
				<a class = "marcar_disponible" href="" data-id="{{l.id}}" >Marcar como Disponible</a>
			{% endif %}

		</div>
	</div>
{% endfor %}

<a href="{% url 'libros:nuevo_libro' 'biblioteca_compartida' biblioteca_compartida.slug  %}">Nuevo Libro</a>

<hr>

<h3>Libros Prestados</h3>

{% for l in libros_prestados%}
<div class = "panel panel-primary">
	<div class = "panel-body">
		<p> {{l.libro.titulo}} | {{l.libro.autor}} </p>
		<a class ="marcar_devuelto" href="" data-id="{{l.id}}" >Marcar como Devuelto</a>
	</div>
</div>
{% endfor %}


<script>

$(document).ready(function(){

	$(".marcar_no_disponible").on("click", function(e){
		e.preventDefault();
		var id_libro_disp = $(this).data("id");
		$.ajax({
			url: "/libros/marcar_no_disponible/",
			method: "POST",
			data: {
				'id_libro_disp': id_libro_disp,
				'tipo': "biblioteca",
				'csrfmiddlewaretoken': '{{ csrf_token }}'
			}
		});
	});

	$(".marcar_disponible").on("click", function(e){
		e.preventDefault();
		var id_libro = $(this).data("id");
		$.ajax({
			url: "/libros/marcar_disponible/",
			method: "POST",
			data: {
				'id_libro': id_libro,
				'tipo': "biblioteca",
				'csrfmiddlewaretoken': '{{ csrf_token }}'
			}
		});
	});

	$(".marcar_devuelto").on("click", function(e){
		e.preventDefault();
		var id_libro = $(this).data("id");
		$.ajax({
			url: "/libros/marcar_devuelto/",
			method: "POST",
			data: {
				'id_libro': id_libro,
				'tipo': 'biblioteca',
				'csrfmiddlewaretoken': "{{ csrf_token }}" 
			}
		});
	});
});

</script>


{% endblock content %}
